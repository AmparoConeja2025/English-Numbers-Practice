<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego de Escuchar NÃºmeros</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .game-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }
        
        .option-button {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
        }
        
        .option-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .option-button.correct {
            background: linear-gradient(135deg, #10b981, #059669);
            border-color: #059669;
            animation: correctPulse 0.6s ease-in-out;
        }
        
        .option-button.incorrect {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            border-color: #dc2626;
            animation: incorrectShake 0.6s ease-in-out;
        }
        
        .audio-button {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 3px solid transparent;
        }
        
        .audio-button:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }
        
        .audio-button.listen-state {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border-color: #1d4ed8;
        }
        
        .audio-button.repeat-state {
            background: linear-gradient(135deg, #10b981, #059669);
            border-color: #047857;
        }
        
        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes incorrectShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        .stats-card {
            background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
            border: 2px solid #d1d5db;
        }
    </style>
</head>
<body class="p-4">
    <div class="max-w-2xl mx-auto">
        <div class="game-container p-8">
            <h1 class="text-3xl font-bold text-center mb-8 text-gray-800">
                ðŸŽ§ Juego de Escuchar NÃºmeros
            </h1>
            
            <!-- EstadÃ­sticas -->
            <div class="stats-card rounded-xl p-4 mb-6">
                <div class="grid grid-cols-3 gap-4 text-center">
                    <div>
                        <div class="text-2xl font-bold text-green-600" id="correct-count">0</div>
                        <div class="text-sm text-gray-600">Correctas</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-red-600" id="incorrect-count">0</div>
                        <div class="text-sm text-gray-600">Incorrectas</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-blue-600" id="total-count">0</div>
                        <div class="text-sm text-gray-600">Total</div>
                    </div>
                </div>
            </div>
            
            <!-- BotÃ³n de Audio con Sistema de Dos Estados -->
            <div class="text-center mb-8">
                <button id="audio-button" class="audio-button listen-state text-white font-bold py-4 px-8 rounded-full text-lg">
                    ðŸ”Š Escuchar
                </button>
            </div>
            
            <!-- Opciones de NÃºmeros -->
            <div class="grid grid-cols-2 gap-4 mb-6" id="options-container">
                <!-- Las opciones se generarÃ¡n aquÃ­ -->
            </div>
            
            <!-- Mensaje de Resultado -->
            <div id="result-message" class="text-center text-lg font-semibold mb-4 h-8"></div>
            
            <!-- Controles -->
            <div class="text-center">
                <button id="new-game-button" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                    ðŸŽ® Nuevo Juego
                </button>
            </div>
        </div>
    </div>

    <script>
        class NumberListeningGame {
            constructor() {
                this.correctAnswer = null;
                this.options = [];
                this.correctCount = 0;
                this.incorrectCount = 0;
                this.hasListened = false; // Control del estado del botÃ³n
                this.audioContext = null;
                this.isPlaying = false;
                
                this.initAudio();
                this.initEventListeners();
                this.generateNewRound();
            }
            
            initAudio() {
                // Inicializar AudioContext cuando el usuario interactÃºe
                document.addEventListener('click', () => {
                    if (!this.audioContext) {
                        this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    }
                }, { once: true });
            }
            
            initEventListeners() {
                document.getElementById('audio-button').addEventListener('click', () => {
                    this.playAudio();
                });
                
                document.getElementById('new-game-button').addEventListener('click', () => {
                    this.resetGame();
                });
            }
            
            generateNewRound() {
                // Generar nÃºmero correcto (1-100)
                this.correctAnswer = Math.floor(Math.random() * 100) + 1;
                
                // Generar opciones incorrectas
                const incorrectOptions = [];
                while (incorrectOptions.length < 3) {
                    const option = Math.floor(Math.random() * 100) + 1;
                    if (option !== this.correctAnswer && !incorrectOptions.includes(option)) {
                        incorrectOptions.push(option);
                    }
                }
                
                // Mezclar todas las opciones
                this.options = [this.correctAnswer, ...incorrectOptions];
                this.shuffleArray(this.options);
                
                // Resetear estado del botÃ³n a "Escuchar"
                this.hasListened = false;
                this.updateAudioButton();
                
                // Renderizar opciones
                this.renderOptions();
                
                // Limpiar mensaje de resultado
                document.getElementById('result-message').textContent = '';
            }
            
            updateAudioButton() {
                const button = document.getElementById('audio-button');
                
                if (this.hasListened) {
                    // Estado 2: Repetir
                    button.className = 'audio-button repeat-state text-white font-bold py-4 px-8 rounded-full text-lg';
                    button.textContent = 'ðŸ”„ Repetir';
                } else {
                    // Estado 1: Escuchar
                    button.className = 'audio-button listen-state text-white font-bold py-4 px-8 rounded-full text-lg';
                    button.textContent = 'ðŸ”Š Escuchar';
                }
            }
            
            renderOptions() {
                const container = document.getElementById('options-container');
                container.innerHTML = '';
                
                this.options.forEach((number, index) => {
                    const button = document.createElement('button');
                    button.className = 'option-button bg-white hover:bg-gray-50 border-2 border-gray-200 rounded-xl p-6 text-xl font-bold text-gray-800';
                    button.textContent = number;
                    button.addEventListener('click', () => this.checkAnswer(number, button));
                    container.appendChild(button);
                });
                
                // AÃ±adir animaciÃ³n de entrada
                container.classList.add('fade-in');
            }
            
            async playAudio() {
                if (this.isPlaying) return;
                
                this.isPlaying = true;
                
                // Cambiar a estado "Repetir" despuÃ©s del primer click
                if (!this.hasListened) {
                    this.hasListened = true;
                    this.updateAudioButton();
                }
                
                try {
                    if (!this.audioContext) {
                        this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    }
                    
                    // Separar el nÃºmero en dÃ­gitos
                    const digits = this.correctAnswer.toString().split('').map(Number);
                    
                    // Reproducir cada dÃ­gito con una pausa
                    for (let i = 0; i < digits.length; i++) {
                        await this.playDigit(digits[i]);
                        if (i < digits.length - 1) {
                            await this.delay(300); // Pausa entre dÃ­gitos
                        }
                    }
                } catch (error) {
                    console.error('Error al reproducir audio:', error);
                }
                
                this.isPlaying = false;
            }
            
            async playDigit(digit) {
                return new Promise((resolve) => {
                    const oscillator = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);
                    
                    // Frecuencias para cada dÃ­gito (en Hz)
                    const frequencies = {
                        0: 220, 1: 246, 2: 277, 3: 311, 4: 349,
                        5: 392, 6: 440, 7: 494, 8: 554, 9: 622
                    };
                    
                    oscillator.frequency.setValueAtTime(frequencies[digit], this.audioContext.currentTime);
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.3, this.audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.5);
                    
                    oscillator.start();
                    oscillator.stop(this.audioContext.currentTime + 0.5);
                    
                    oscillator.onended = () => resolve();
                });
            }
            
            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
            
            checkAnswer(selectedNumber, buttonElement) {
                const isCorrect = selectedNumber === this.correctAnswer;
                
                if (isCorrect) {
                    this.correctCount++;
                    buttonElement.classList.add('correct');
                    document.getElementById('result-message').textContent = 'Â¡Correcto! ðŸŽ‰';
                    document.getElementById('result-message').className = 'text-center text-lg font-semibold mb-4 h-8 text-green-600';
                } else {
                    this.incorrectCount++;
                    buttonElement.classList.add('incorrect');
                    document.getElementById('result-message').textContent = `Incorrecto. El nÃºmero era ${this.correctAnswer}`;
                    document.getElementById('result-message').className = 'text-center text-lg font-semibold mb-4 h-8 text-red-600';
                }
                
                this.updateStats();
                
                // Deshabilitar todas las opciones
                document.querySelectorAll('.option-button').forEach(btn => {
                    btn.disabled = true;
                    btn.classList.add('opacity-50');
                });
                
                // Generar nueva ronda despuÃ©s de 2 segundos
                setTimeout(() => {
                    this.generateNewRound();
                }, 2000);
            }
            
            updateStats() {
                document.getElementById('correct-count').textContent = this.correctCount;
                document.getElementById('incorrect-count').textContent = this.incorrectCount;
                document.getElementById('total-count').textContent = this.correctCount + this.incorrectCount;
            }
            
            resetGame() {
                this.correctCount = 0;
                this.incorrectCount = 0;
                this.hasListened = false;
                this.updateStats();
                this.generateNewRound();
            }
            
            shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }
        }
        
        // Inicializar el juego cuando la pÃ¡gina estÃ© lista
        document.addEventListener('DOMContentLoaded', () => {
            new NumberListeningGame();
        });
    </script>
</body>
</html>
